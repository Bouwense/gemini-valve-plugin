import{a as fe,B as _e,j as w,o as Z,c as L,l as E,f as G,n,m as F,C as g,u as i,K,w as he,M as ee,Y as oe,H as we}from"./pinia-DEH50WAs.js";import{a as R,_ as ye}from"./SendQuote.vue_vue_type_style_index_0_lang-Bgmm8C5A.js";import{n as Ne,b as Ce,c as Le,o as Se,l as be}from"./widget-TfP9KzIn.js";import{L as ke,u as Pe}from"./index-BUjNB5vr.js";import{u as Te}from"./translationsStore-CB5AosK1.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./convert-case-to-camel-case.utils-BvCCmEmI.js";const Fe={class:"ccb-two-points-location"},Me={class:"ccb-two-points-location__input-wrapper"},De={class:"label"},Ie={class:"ccb-two-points-location__description"},$e={key:0},Oe={key:1,class:"ccb-two-points-location__adressname"},Ve={class:"ccb-location-modal"},Be={class:"ccb-location-modal__body"},Ae={class:"ccb-location-modal__sidebar"},Ee={class:"ccb-location-modal__inputs"},Ge={class:"ccb-location-modal__input"},Ke={for:"latitude"},Re=["id","placeholder"],je={class:"ccb-location-modal__input"},qe={for:"longitude"},He=["id","placeholder"],Ue={class:"ccb-location-modal__distance"},ze=["id"],Ye={class:"ccb-location-modal__footer"},Je=fe({__name:"TwoPoints",props:{field:{}},setup(te){const ae=te,{field:o}=_e(ae),se=Se(),j=Ne(),y=Ce(),q=be(),c=Te(),H=Le(),M=w(),{getGoogleApiKey:ne,mapOptions:le,generateId:ie,getMeasure:k,getMarkerIconPath:U,calculateValueByEachCost:re,eachCost:ce,generateGoogleLink:z}=Pe();let S=ie(4),P=w({lat:51.554867,lng:-.109112}),e=w({from:{addressName:"",coordinates:{lat:0,lng:0}},to:{addressName:"",coordinates:{lat:0,lng:0}}}),m=w(""),N=w("from"),f=w(null),v=w({from:null,to:null});const de=new ke({apiKey:ne(),version:"weekly",libraries:["places","geometry"]});Z(()=>{o.value.displayValue&&(e.value.from.addressName=o.value.userSelectedOptions.twoPoints.from.addressName,e.value.to.addressName=o.value.userSelectedOptions.twoPoints.to.addressName,setTimeout(()=>{e.value.from.coordinates=o.value.userSelectedOptions.twoPoints.from.coordinates,e.value.to.coordinates=o.value.userSelectedOptions.twoPoints.to.coordinates,m.value=o.value.userSelectedOptions.distance,P.value=o.value.userSelectedOptions.twoPoints.from.coordinates,P.value=o.value.userSelectedOptions.twoPoints.to.coordinates,I("from",o.value.userSelectedOptions.twoPoints.from.coordinates),I("to",o.value.userSelectedOptions.twoPoints.to.coordinates),$()},100))}),Z(()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(t=>{const a=t.coords.latitude,s=t.coords.longitude;let l={lat:a,lng:s};P.value=l,D()},()=>{D()}):D()});let T;const D=()=>{de.load().then(async()=>{const{Map:t}=await google.maps.importLibrary("maps");T=new t(document.getElementById(S),{...le(),mapId:S,center:{...P.value}});const a=document.getElementById(B.value),s=document.getElementById(A.value),l=new google.maps.places.SearchBox(a),r=new google.maps.places.SearchBox(s);l.addListener("places_changed",()=>{J(l,"from")}),r.addListener("places_changed",()=>{J(r,"to")}),google.maps.event.addListener(T,"click",d=>{if(N){const p={lat:d.latLng?d.latLng.lat():0,lng:d.latLng?d.latLng.lng():0};e.value[N.value].coordinates=p,I(N.value,p);const _=N.value==="from"?B.value:A.value;new google.maps.Geocoder().geocode({location:d.latLng},(u,x)=>{var C;if(x==="OK"&&u&&u.length>0){const b=u[0].formatted_address;(C=document.getElementById(_))==null||C.setAttribute("value",b),e.value[N.value].addressName=b,e.value.from.coordinates&&e.value.to.coordinates&&$()}else console.error("Geocoding failed:",x)})}})})},ue=()=>{V.value&&ve()},ve=()=>{o.value.value=parseFloat(re(parseFloat(m.value),X.value).toFixed(2)),o.value.displayValue=ge.value,o.value.extraDisplayView=[`${c.getTranslations.from}: ${e.value.from.addressName.length>30?e.value.from.addressName.slice(0,30)+"...":e.value.from.addressName}`,`${c.getTranslations.toDestination}: ${e.value.to.addressName.length>34?e.value.to.addressName.slice(0,34)+"...":e.value.to.addressName}`,`${W.value}`];const t={distance:m.value,distance_view:W.value,measure:k(),eachCost:o.value.eachCost,twoPoints:{from:{addressName:e.value.from.addressName,coordinates:e.value.from.coordinates,addressLink:z(e.value.from.coordinates)},to:{addressName:e.value.to.addressName,coordinates:e.value.to.coordinates,addressLink:z(e.value.to.coordinates)}}};o.value.userSelectedOptions=t,y.updateField(o.value.alias,o.value),j.applyConditionForField(o.value.alias),y.getPageBreakEnabled&&y.getActivePage.action==="not_skip"&&H.checkPageFieldsConditions(),O()},Y=t=>{N.value=t},me=()=>{o.value.userSelectedOptions={},Object.values(v.value).forEach(t=>{t&&(t.map=null)}),v.value.from=null,v.value.to=null,f.value!==null&&f.value.setMap(null),m.value="0",e.value={from:{addressName:"",coordinates:{lat:0,lng:0}},to:{addressName:"",coordinates:{lat:0,lng:0}}},o.value.value=0,o.value.displayValue="",o.value.extraDisplayView=[],y.updateField(o.value.alias,o.value),j.applyConditionForField(o.value.alias),y.getPageBreakEnabled&&y.getActivePage.action==="not_skip"&&H.checkPageFieldsConditions(),O()},I=async(t,a)=>{t==="from"&&v.value.from?(v.value.from.map=null,v.value.from=null):t==="to"&&v.value.to&&(v.value.to.map=null,v.value.to=null);const s=document.createElement("img");s.style.width="40px",s.style.height="40px",s.src=U();const{AdvancedMarkerElement:l}=await google.maps.importLibrary("marker"),r=new l({position:a,map:T});U()&&(r.content=s),t==="from"?v.value.from=r:v.value.to=r},J=(t,a)=>{var p,_,h,u;const s=t.getPlaces()||[];if(!Array.isArray(s)||(s==null?void 0:s.length)===0)return;const l=s[0],r={lat:((_=(p=l==null?void 0:l.geometry)==null?void 0:p.location)==null?void 0:_.lat())||0,lng:((u=(h=l==null?void 0:l.geometry)==null?void 0:h.location)==null?void 0:u.lng())||0},d=l.formatted_address;e.value[a].coordinates={lat:r.lat,lng:r.lng},e.value[a].addressName=d||"",e.value.from.coordinates&&e.value.to.coordinates&&$()},$=async()=>{try{const t=await Q();m.value=t,f.value&&(f.value.setMap(null),f.value=null);const a=new google.maps.DirectionsService;f.value=new google.maps.DirectionsRenderer({suppressMarkers:!0}),f.value&&f.value.setMap(T);const s=[{location:e.value.from.coordinates,stopover:!0},{location:e.value.to.coordinates,stopover:!0}],l=new google.maps.LatLng(e.value.from.coordinates),r=new google.maps.LatLng(e.value.to.coordinates),d={origin:l,destination:r,waypoints:s,travelMode:google.maps.TravelMode.DRIVING};a.route(d,(p,_)=>{var h;_==="OK"&&((h=f.value)==null||h.setDirections(p),Q().then(u=>{m.value=u}))})}catch(t){throw t}},Q=()=>{const t=new google.maps.DirectionsService,a=[{location:new google.maps.LatLng(e.value.from.coordinates.lat,e.value.from.coordinates.lng),stopover:!0},{location:new google.maps.LatLng(e.value.to.coordinates.lat,e.value.to.coordinates.lng),stopover:!0}],s={origin:new google.maps.LatLng(e.value.from.coordinates.lat,e.value.from.coordinates.lng),destination:new google.maps.LatLng(e.value.to.coordinates.lat,e.value.to.coordinates.lng),waypoints:a,travelMode:google.maps.TravelMode.DRIVING};return new Promise(l=>{t.route(s,(r,d)=>{var p,_;if(d==="OK"){const h=((_=(p=r==null?void 0:r.routes[0])==null?void 0:p.legs)==null?void 0:_.reduce((x,C)=>{var b;return x+(((b=C==null?void 0:C.distance)==null?void 0:b.value)||0)},0))||0;let u;k()==="miles"?u=(h*621371e-9).toFixed(2):u=(h*.001).toFixed(2),l(u)}})})},pe=()=>{M.value.showPopup()},O=()=>{M.value.hidePopup()},ge=L(()=>{var t;return o.value.useCurrency?se.getCommonFieldDisplayView(o.value):((t=o.value.value)==null?void 0:t.toString())||""}),W=L(()=>{const t=q.getCurrencyOptions(o.value),a=t.currency,s=t.currencyPosition;let l=0;o.value.value&&(l=ce(parseFloat(m.value),X.value));const r=q.parseCurrencyPosition(l.toString(),a,s||"left");let d=o.value.useCurrency?`${r}`:l;return`${c.getTranslations.distance}: ${m.value} ${k()} x ${d}`}),V=L(()=>e.value.from.addressName&&e.value.to.addressName&&m.value),X=L(()=>{var t;return{value:{pricingType:o.value.pricingType,eachCost:String(o.value.eachCost),distanceCostList:o.value.distanceCostList.map(a=>({from:a.from,to:a.to,cost:String(a.cost)})),lastDistanceCost:{cost:String(((t=o.value.lastDistanceCost)==null?void 0:t.cost)||"0")}}}}),B=L(()=>`${o.value.alias}-locationFrom-${S}`),A=L(()=>`${o.value.alias}-locationTo-${S}`);return(t,a)=>(G(),E("div",Fe,[n("div",Me,[n("button",{class:"ccb-two-points-location__action",onClick:pe},[a[4]||(a[4]=n("span",{class:"icon"},[n("i",{class:"ccb-icon-location"})],-1)),n("span",De,g(i(c).getTranslations.openMap),1)]),n("div",Ie,[V.value?(G(),E("span",Oe,[n("span",null,g(i(c).getTranslations.from)+":",1),K(" "+g(i(e).from.addressName)+" ",1),a[5]||(a[5]=n("br",null,null,-1)),n("span",null,g(i(c).getTranslations.to)+":",1),K(" "+g(i(e).to.addressName),1)])):(G(),E("span",$e,g(i(c).getTranslations.chooseFromMap),1))])]),F(ye,{ref_key:"popup",ref:M},{default:he(()=>[n("div",Ve,[n("div",Be,[n("div",Ae,[n("div",Ee,[n("div",Ge,[n("label",Ke,g(i(c).getTranslations.from),1),ee(n("input",{id:B.value,type:"text",placeholder:i(c).getTranslations.enterAddress,"onUpdate:modelValue":a[0]||(a[0]=s=>i(e).from.addressName=s),onClick:a[1]||(a[1]=s=>Y("from"))},null,8,Re),[[oe,i(e).from.addressName]])]),n("div",je,[n("label",qe,g(i(c).getTranslations.toDestination),1),ee(n("input",{id:A.value,"onUpdate:modelValue":a[2]||(a[2]=s=>i(e).to.addressName=s),type:"text",placeholder:i(c).getTranslations.enterAddress,onClick:a[3]||(a[3]=s=>Y("to"))},null,8,He),[[oe,i(e).to.addressName]])])]),n("div",Ue,[K(g(i(c).getTranslations.distance)+": ",1),n("span",null,g(`${i(m)} ${i(k)()}`),1)])]),n("div",{id:i(S),class:"ccb-location-modal__map"},null,8,ze)]),n("div",Ye,[F(R,{type:"light",text:i(c).getTranslations.clearLocation,class:we(["clear",{disable:!V.value}]),onClick:me},null,8,["text","class"]),F(R,{type:"light",text:i(c).getTranslations.cancel,onClick:O},null,8,["text"]),F(R,{type:"success",text:i(c).getTranslations.saveLocation,onClick:ue},null,8,["text"])])])]),_:1},512)]))}}),no=xe(Je,[["__scopeId","data-v-2db2d160"]]);export{no as default};
//# sourceMappingURL=TwoPoints-D3oR3vWG.js.map
