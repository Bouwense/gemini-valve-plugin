import{a as $,_ as ye}from"./SendQuote.vue_vue_type_style_index_0_lang-Bgmm8C5A.js";import{b as _e,n as fe,c as he,o as we,l as Ce}from"./widget-TfP9KzIn.js";import{L as ke,u as be}from"./index-BUjNB5vr.js";import{u as xe}from"./translationsStore-CB5AosK1.js";import{a as Se,B as Le,j as m,o as J,c as y,l as I,f as E,n as i,m as C,C as T,u,w as Be,H as Fe}from"./pinia-DEH50WAs.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./convert-case-to-camel-case.utils-BvCCmEmI.js";const Pe={class:"ccb-user-location"},Me={class:"ccb-user-location__input-wrapper"},De={class:"label"},$e={class:"ccb-user-location__description"},Ie={key:0},Ee={key:1,class:"ccb-user-location__adressname"},Te={class:"ccb-location-modal"},Ae={class:"ccb-location-modal__body"},Ne=["id"],Ge={class:"ccb-location-modal__search"},Oe=["id","placeholder"],Ke={class:"ccb-location-modal__footer"},Ue=Se({__name:"UserLocation",props:{field:{}},setup(Q){const w=Q,{field:t}=Le(w),g=_e(),A=fe(),W=we(),N=Ce(),p=xe(),G=he(),k=m(),{getGoogleApiKey:X,mapOptions:Y,generateId:Z,parseLocationCoordinates:b,calculateValueByEachCost:O,getMeasure:x,eachCost:ee,getMarkerIconPath:K}=be(),te=new ke({apiKey:X(),version:"weekly",libraries:["places","geometry"]});let r=m({lat:51.554867,lng:-.109112}),S=m([]),l=m(""),_=Z(4),f=m(0),oe=m(""),v;J(()=>{typeof google<"u"&&w.field.extraDisplayView&&(l.value=w.field.extraDisplayView[0],setTimeout(()=>{P(b(w.field.userLocation.toString()))},1e3))});const L=y(()=>{var e;return{value:{pricingType:t.value.pricingType,eachCost:String(t.value.eachCost),distanceCostList:t.value.distanceCostList.map(o=>({from:o.from,to:o.to,cost:String(o.cost)})),lastDistanceCost:{cost:String(((e=t.value.lastDistanceCost)==null?void 0:e.cost)||"0")}}}}),B=y(()=>t.value.userLocation),ae=y(()=>l.value.length>40?`${l.value.slice(0,40)} + ...`:l.value),se=y(()=>{var e;return t.value.useCurrency?W.getCommonFieldDisplayView(t.value):((e=t.value.value)==null?void 0:e.toString())||""}),ne=y(()=>{const e=N.getCurrencyOptions(t.value),o=e.currency,c=e.currencyPosition;let s=0;t.value.value&&(s=ee(f.value,L.value));const a=N.parseCurrencyPosition(s.toString(),o,c||"left");let n=t.value.useCurrency?`${a}`:s;return`${p.getTranslations.distance}: ${f.value} ${x()} x ${n}`}),U=y(()=>`${t.value.alias}-search-input-${_}`),F=()=>{te.load().then(async()=>{const{Map:e}=await google.maps.importLibrary("maps");v=new e(document.getElementById(_),{...Y(),mapId:_,center:{...r.value}});const o=document.getElementById(U.value),c=new google.maps.places.SearchBox(o);v.addListener("bounds_changed",()=>{c.setBounds(v.getBounds())}),c.addListener("places_changed",()=>{const s=c.getPlaces();if((s==null?void 0:s.length)===0)return;const a=new google.maps.LatLngBounds;s==null||s.forEach(n=>{if(!n.geometry||!n.geometry.location)return;const d={lat:n.geometry.location.lat(),lng:n.geometry.location.lng()};P(d),n.geometry.viewport?a.union(n.geometry.viewport):a.extend(n.geometry.location),l.value=n.formatted_address||"",r.value.lat=n.geometry.location.lat(),r.value.lng=n.geometry.location.lng()}),v.fitBounds(a)}),v.addListener("click",s=>{const a=s.latLng;P({lat:(a==null?void 0:a.lat())||0,lng:(a==null?void 0:a.lng())||0}),r.value.lat=(a==null?void 0:a.lat())||0,r.value.lng=(a==null?void 0:a.lng())||0,new google.maps.Geocoder().geocode({location:a},(d,h)=>{h==="OK"&&Array.isArray(d)&&d[0]&&(l.value=d[0].formatted_address,o.value=d[0].formatted_address)})})})},ie=()=>{l.value=""},le=()=>{k.value.showPopup()},V=()=>{k.value.hidePopup()},q=()=>{S.value.forEach(e=>{e.map=null}),S.value=[]},P=async e=>{q();const o=document.createElement("img");o.style.width="40px",o.style.height="40px",o.src=K();const{AdvancedMarkerElement:c}=await google.maps.importLibrary("marker"),s=new c({position:e,map:v});K()&&(s.content=o),S.value.push(s)},ce=()=>{if(l.value){ie();const e=document.getElementById(_);q(),e&&(e.value=""),de(),V()}},re=()=>{const e=new google.maps.DirectionsService,o=b(B.value.toString()),c=r.value,a={origin:o,destination:c,waypoints:[{location:o,stopover:!0},{location:c,stopover:!0}],travelMode:google.maps.TravelMode.DRIVING},n=x();return new Promise(d=>{e.route(a,(h,ve)=>{var H,R;if(ve==="OK"){const j=((R=(H=h==null?void 0:h.routes[0])==null?void 0:H.legs)==null?void 0:R.reduce((me,D)=>{var z;return me+(((z=D==null?void 0:D.distance)==null?void 0:z.value)||0)},0))||0;let M;n==="miles"?M=(j*621371e-9).toFixed(2):M=(j*.001).toFixed(2),d(M)}})})},ue=async()=>{l.value&&(f.value=Number(await re()),oe.value=`${O(f.value,L.value)} ${x()}`,ge(),V())},de=()=>{t.value.value=0,t.value.displayValue="0",t.value.extraDisplayView=[],g.updateField(t.value.alias,t.value),A.applyConditionForField(t.value.alias),g.getPageBreakEnabled&&g.getActivePage.action==="not_skip"&&G.checkPageFieldsConditions()},pe=e=>`https://www.google.com/maps/search/?api=1&query=${e.lat},${e.lng}`,ge=()=>{t.value.value=parseFloat(O(f.value,L.value).toFixed(2))||0,t.value.displayValue=se.value,t.value.extraDisplayView=[ae.value.toString(),ne.value.toString()],t.value.userSelectedOptions={coordinates:[r.value.lat,r.value.lng],addressLink:pe(r.value)},g.updateField(t.value.alias,t.value),A.applyConditionForField(t.value.alias),g.getPageBreakEnabled&&g.getActivePage.action==="not_skip"&&G.checkPageFieldsConditions()};return J(()=>{B.value&&(r.value=b(B.value.toString())),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{const o=e.coords.latitude,c=e.coords.longitude;r.value={lat:o,lng:c},F()},()=>{F()}):F()}),(e,o)=>(E(),I("div",Pe,[i("div",Me,[i("button",{class:"ccb-user-location__action",onClick:le},[o[0]||(o[0]=i("span",{class:"icon"},[i("i",{class:"ccb-icon-location"})],-1)),i("span",De,T(u(p).getTranslations.openMap),1)]),i("div",$e,[u(l)?(E(),I("span",Ee,T(u(l)),1)):(E(),I("span",Ie,T(u(p).getTranslations.chooseFromMap),1))])]),C(ye,{ref_key:"popup",ref:k},{default:Be(()=>[i("div",Te,[i("div",Ae,[i("div",{id:u(_),class:"ccb-location-modal__map"},null,8,Ne),i("div",Ge,[o[1]||(o[1]=i("i",{class:"ccb-icon-Search-Magnifier"},null,-1)),i("input",{id:U.value,class:"controls",type:"text",placeholder:u(p).getTranslations.searchLocation},null,8,Oe)])]),i("div",Ke,[C($,{type:"light",text:u(p).getTranslations.clearLocation,class:Fe(["clear",{disable:!u(l)}]),"on-click":ce},null,8,["text","class"]),C($,{type:"light",text:u(p).getTranslations.cancel,"on-click":V},null,8,["text"]),C($,{type:"success",text:u(p).getTranslations.saveLocation,"on-click":ue},null,8,["text"])])])]),_:1},512)]))}}),Ye=Ve(Ue,[["__scopeId","data-v-e112a4c2"]]);export{Ye as default};
//# sourceMappingURL=UserLocation-UNVlPyOX.js.map
